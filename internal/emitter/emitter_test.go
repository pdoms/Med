package emitter

import (
	"bytes"
	"testing"
)

func TestGetTestMsg(t *testing.T) {
	want := "MSH|^~\\&|ZIS|1^AHospital|||199605141144||ADT^A01|20031104082400|P|2.3|||\nAL|NE|||8859/15|<CR>EVN|A01|20031104082400.0000+0100|20031104082400\nPID||\"\"|10||Vries^Danny^D.^^de||19951202|M|||Rembrandlaan^7^Leiden^^7301TH^\"\"\n^^P||\"\"|\"\"||\"\"|||||||\"\"|\"\"<CR>PV1||I|3w^301^\"\"^01|S|||100^van den Berg^^A.S.\n^^\"\"^dr|\"\"||9||||H||||20031104082400.0000+0100"
	got, _ := GetTestMsg()
	if got != want {
		t.Errorf("got %q want %q", got, want)
	}
}

func TestMllp(t *testing.T) {
	want := []byte{11, 77, 83, 72, 124, 94, 126, 92, 38, 124, 90, 73, 83, 124, 49, 94, 65, 72, 111, 115, 112, 105, 116, 97, 108, 124, 124, 124, 49, 57, 57, 54, 48, 53, 49, 52, 49, 49, 52, 52, 124, 124, 65, 68, 84, 94, 65, 48, 49, 124, 50, 48, 48, 51, 49, 49, 48, 52, 48, 56, 50, 52, 48, 48, 124, 80, 124, 50, 46, 51, 124, 124, 124, 10, 65, 76, 124, 78, 69, 124, 124, 124, 56, 56, 53, 57, 47, 49, 53, 124, 60, 67, 82, 62, 69, 86, 78, 124, 65, 48, 49, 124, 50, 48, 48, 51, 49, 49, 48, 52, 48, 56, 50, 52, 48, 48, 46, 48, 48, 48, 48, 43, 48, 49, 48, 48, 124, 50, 48, 48, 51, 49, 49, 48, 52, 48, 56, 50, 52, 48, 48, 10, 80, 73, 68, 124, 124, 34, 34, 124, 49, 48, 124, 124, 86, 114, 105, 101, 115, 94, 68, 97, 110, 110, 121, 94, 68, 46, 94, 94, 100, 101, 124, 124, 49, 57, 57, 53, 49, 50, 48, 50, 124, 77, 124, 124, 124, 82, 101, 109, 98, 114, 97, 110, 100, 108, 97, 97, 110, 94, 55, 94, 76, 101, 105, 100, 101, 110, 94, 94, 55, 51, 48, 49, 84, 72, 94, 34, 34, 10, 94, 94, 80, 124, 124, 34, 34, 124, 34, 34, 124, 124, 34, 34, 124, 124, 124, 124, 124, 124, 124, 34, 34, 124, 34, 34, 60, 67, 82, 62, 80, 86, 49, 124, 124, 73, 124, 51, 119, 94, 51, 48, 49, 94, 34, 34, 94, 48, 49, 124, 83, 124, 124, 124, 49, 48, 48, 94, 118, 97, 110, 32, 100, 101, 110, 32, 66, 101, 114, 103, 94, 94, 65, 46, 83, 46, 10, 94, 94, 34, 34, 94, 100, 114, 124, 34, 34, 124, 124, 57, 124, 124, 124, 124, 72, 124, 124, 124, 124, 50, 48, 48, 51, 49, 49, 48, 52, 48, 56, 50, 52, 48, 48, 46, 48, 48, 48, 48, 43, 48, 49, 48, 48, 28, 13}
	msg := "MSH|^~\\&|ZIS|1^AHospital|||199605141144||ADT^A01|20031104082400|P|2.3|||\nAL|NE|||8859/15|<CR>EVN|A01|20031104082400.0000+0100|20031104082400\nPID||\"\"|10||Vries^Danny^D.^^de||19951202|M|||Rembrandlaan^7^Leiden^^7301TH^\"\"\n^^P||\"\"|\"\"||\"\"|||||||\"\"|\"\"<CR>PV1||I|3w^301^\"\"^01|S|||100^van den Berg^^A.S.\n^^\"\"^dr|\"\"||9||||H||||20031104082400.0000+0100"
	got := Mllp(msg)
	if !bytes.Equal(want, got) {
		t.Errorf("got %q want %q", got, want)
	}
}
